<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-recipe-book/jenkins/migration_to_lxc" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Migration to Proxmox LXC | Clematis Explained</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://grauds.github.io/clematis.doc/img/clematis_small.svg"><meta data-rh="true" name="twitter:image" content="https://grauds.github.io/clematis.doc/img/clematis_small.svg"><meta data-rh="true" property="og:url" content="https://grauds.github.io/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migration to Proxmox LXC | Clematis Explained"><meta data-rh="true" name="description" content="The former Docker-based installation of Jenkins was convenient in terms of dockerized"><meta data-rh="true" property="og:description" content="The former Docker-based installation of Jenkins was convenient in terms of dockerized"><link data-rh="true" rel="icon" href="/clematis.doc/img/clematis_small.svg"><link data-rh="true" rel="canonical" href="https://grauds.github.io/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc"><link data-rh="true" rel="alternate" href="https://grauds.github.io/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc" hreflang="en"><link data-rh="true" rel="alternate" href="https://grauds.github.io/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Recipe Book","item":"https://grauds.github.io/clematis.doc/docs/recipe-book/"},{"@type":"ListItem","position":2,"name":"Migration to Proxmox LXC","item":"https://grauds.github.io/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc"}]}</script><link rel="alternate" type="application/rss+xml" href="/clematis.doc/blog/rss.xml" title="Clematis Explained RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/clematis.doc/blog/atom.xml" title="Clematis Explained Atom Feed"><link rel="stylesheet" href="/clematis.doc/assets/css/styles.d6176e73.css">
<script src="/clematis.doc/assets/js/runtime~main.b0d43d3c.js" defer="defer"></script>
<script src="/clematis.doc/assets/js/main.7bcef020.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/clematis.doc/"><div class="navbar__logo"><img src="/clematis.doc/img/clematis_small.svg" alt="Clematis Docs Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/clematis.doc/img/clematis_small.svg" alt="Clematis Docs Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Clematis Explained</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/clematis.doc/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/clematis.doc/blog">Blog</a><a href="https://github.com/grauds" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/clematis.doc/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/clematis.doc/docs/web-applications">Web Applications</a><button aria-label="Expand sidebar category &#x27;Web Applications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/clematis.doc/docs/web-applications-security">Web Applications Security</a><button aria-label="Expand sidebar category &#x27;Web Applications Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/clematis.doc/docs/recipe-book">Recipe Book</a><button aria-label="Collapse sidebar category &#x27;Recipe Book&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/java/binary_search">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc">Jenkins</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/clematis.doc/docs/recipe-book/jenkins/migration_to_lxc">Migration to Proxmox LXC</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/react/props-and-state">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/testing/to-be-true">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/typescript/typescript-absolute-import">Typescript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/webpack/spa">Webpack</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/clematis.doc/docs/recipe-book/zabbix/jmxmp_setup">Zabbix</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/clematis.doc/docs/outro">What is a fullstack developer?</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/clematis.doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/clematis.doc/docs/recipe-book"><span>Recipe Book</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Jenkins</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Migration to Proxmox LXC</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migration to Proxmox LXC</h1></header>
<p>The former Docker-based installation of Jenkins was convenient in terms of dockerized
builds and deployment since it was colocated with the applications in the same Docker
process. However, this approach lacks flexibility when it comes to deploying to different
virtual machines and to the cloud, since the former Jenkins pipeline was
only capable of working with local Docker via Linux command line.
Also, heavy builds often take up valuable
application resources. So, to be more professional and flexible,
a dedicated server is needed for Jenkins.</p>
<p>Proxmox Linux Containers combine proper isolation with a dynamic resources allocation without
a restart, which is perfect for the above goals.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-from-a-lxc-template">Install From a LXC Template<a href="#install-from-a-lxc-template" class="hash-link" aria-label="Direct link to Install From a LXC Template" title="Direct link to Install From a LXC Template">​</a></h2>
<p>I use <a href="https://www.turnkeylinux.org/jenkins" target="_blank" rel="noopener noreferrer">Turnkey Jenkins</a> to install a preconfigured Debian with Jenkins.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-docker">Install Docker<a href="#install-docker" class="hash-link" aria-label="Direct link to Install Docker" title="Direct link to Install Docker">​</a></h2>
<p>The best option for Debian is to use the short command from Docker.com:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Proxmox LXC</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://get.docker.com | sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DOCKER_COMPOSE_VERSION=2.24.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -SL https://github.com/docker/compose/releases/download/v${DOCKER_COMPOSE_VERSION}/docker-compose-linux-x86_64     -o /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x /usr/local/bin/docker-compose</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usermod -aG docker jenkins</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generate-ssh-key-pair-for-yoda">Generate SSH Key Pair for Yoda<a href="#generate-ssh-key-pair-for-yoda" class="hash-link" aria-label="Direct link to Generate SSH Key Pair for Yoda" title="Direct link to Generate SSH Key Pair for Yoda">​</a></h2>
<p>New Jenkins will use ssh-agent to do the deployments, so it will need an SSH Key Pair for
Yoda. I&#x27;ve made a shortcut and use my own account to do the deployments for Yoda, in general
it is advised to use a dedicated account.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Proxmox LXC</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -t ed25519 -C &quot;jenkins@yoda-deploy&quot; -f ~/.ssh/yoda_jenkins_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-copy-id -i ~/.ssh/yoda_jenkins_key.pub anton@[Yoda_IP]</span><br></span></code></pre></div></div>
<p>Verify it is installed well (should connect without a password):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Proxmox LXC</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh -i ~/.ssh/yoda_jenkins_key anton@[Yoda_IP]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-data">Migrate Data<a href="#migrate-data" class="hash-link" aria-label="Direct link to Migrate Data" title="Direct link to Migrate Data">​</a></h2>
<p>The data migration may be done the easy way if followed the recipe below. The former Jenkins
installation is a Docker container on Yoda.</p>
<ol>
<li>Backup Jenkins Data from Docker</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Yoda</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker stop &lt;jenkins_container_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker cp &lt;jenkins_container_name&gt;:/var/jenkins_home /tmp/jenkins_backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OR if using a mounted volume:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /path/to/jenkins_home /tmp/jenkins_backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar czvf jenkins_backup.tar.gz -C /tmp jenkins_backup</span><br></span></code></pre></div></div>
<p>The output is the archive <code>jenkins_backup.tar.gz</code>.</p>
<ol start="2">
<li>Copy Backup to LXC</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Yoda</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp jenkins_backup.tar.gz root@[LXC_IP]:/root</span><br></span></code></pre></div></div>
<p>Please check that LXC is not running at this stage. The working directory of the clean
installation has to be moved aside.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">On Proxmox LXC</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /var/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv lib/jenkins/ lib/_jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar xzvf /root/jenkins_backup.tar.gz -C .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown -R jenkins:jenkins /var/jenkins_backup/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv jenkins_backup/ /var/lib/jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status jenkins</span><br></span></code></pre></div></div>
<p>At this point the new installation of Jenkins should be up and running, with all the jobs,
credentials and history preserved. However, it won&#x27;t be deploying to Yoda without changes
in the pipelines of each project.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-ssh-private-key-in-jenkins">Install SSH Private Key in Jenkins<a href="#install-ssh-private-key-in-jenkins" class="hash-link" aria-label="Direct link to Install SSH Private Key in Jenkins" title="Direct link to Install SSH Private Key in Jenkins">​</a></h2>
<p>In Jenkins:</p>
<ol>
<li>Go to Manage Jenkins → Credentials.</li>
<li>Choose your scope (e.g., global, or folder-specific).</li>
<li>Add a new SSH Username with private key credential:</li>
</ol>
<ul>
<li>ID: yoda-anton-key (this must match the pipeline)</li>
<li>Username: anton</li>
<li>Private Key: Enter directly or paste from ~/.ssh/yoda_jenkins_key</li>
<li>Description: “Yoda SSH Key for Jenkins”</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-pipelines">Update Pipelines<a href="#update-pipelines" class="hash-link" aria-label="Direct link to Update Pipelines" title="Direct link to Update Pipelines">​</a></h2>
<p>Jenkins will build locally, as before, but now the images have to be copied to Yoda and
deployed to Docker Compose remotely. Here are the required changes, for example, in a Money Tracker UI project:</p>
<div class="language-jenkins codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Jenkinsfile</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-jenkins codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tools { nodejs &quot;Node18&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CERT_DIR = &quot;${WORKSPACE}/docker/nginx/ssl&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    REMOTE_HOST = [Yoda_IP]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    REMOTE_USER = &quot;anton&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SSH_DEST = &quot;${REMOTE_USER}@${REMOTE_HOST}&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    REMOTE_APP_DIR = &quot;/home/anton/deploy/mt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // export images to archives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stage(&#x27;Export Docker Images&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mkdir -p docker_export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          docker save money.tracker.ui.uat &gt; docker_export/uat.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          docker save money.tracker.ui.demo &gt; docker_export/demo.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // copy images to the deployment server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stage(&#x27;Transfer Files to Yoda&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sshagent (credentials: [&#x27;yoda-anton-key&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [ -d ~/.ssh ] || mkdir ~/.ssh &amp;&amp; chmod 0700 ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scp -o StrictHostKeyChecking=no -r &quot;${CERT_DIR}&quot; &quot;${SSH_DEST}:${REMOTE_APP_DIR}/certs&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scp -o StrictHostKeyChecking=no docker_export/*.tar &quot;${SSH_DEST}:${REMOTE_APP_DIR}/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scp -o StrictHostKeyChecking=no &quot;apps/money-tracker-ui/jenkins/docker-compose.yml&quot; &quot;${SSH_DEST}:${REMOTE_APP_DIR}/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // load to Docker remotely</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stage(&#x27;Deploy on Yoda&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sshagent (credentials: [&#x27;yoda-anton-key&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ssh ${SSH_DEST} &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              docker rm -f clematis-money-tracker-ui clematis-money-tracker-ui-demo 2&gt;/dev/null || true &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              docker load &lt; ${REMOTE_APP_DIR}/uat.tar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              docker load &lt; ${REMOTE_APP_DIR}/demo.tar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              docker compose -f ${REMOTE_APP_DIR}/docker-compose.yml up -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>These stages can be easily adapted to other projects as well.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pipeline-with-variables">Pipeline With Variables<a href="#pipeline-with-variables" class="hash-link" aria-label="Direct link to Pipeline With Variables" title="Direct link to Pipeline With Variables">​</a></h3>
<p>In some cases Jenkins variables should be merged to the commandline executed on another server. This
can be done a bit trickily with export of the variables to environment variables:</p>
<div class="language-jenkins codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Jenkinsfile</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-jenkins codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Deploy on Yoda&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    KEYCLOAK_SECRET = credentials(&#x27;MT_API_KEYCLOAK_SECRET&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SPRING_DATASOURCE_PASSWORD = credentials(&#x27;MT_FIREBIRD_PASSWORD&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sshagent (credentials: [&#x27;yoda-anton-key&#x27;]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sh &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ssh ${SSH_DEST} &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cd ${REMOTE_APP_DIR} &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            docker rm -f rm -f clematis-money-tracker-db clematis-money-tracker-db-demo clematis-money-tracker-api clematis-money-tracker-api-demo 2&gt;/dev/null || true &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            export KEYCLOAK_SECRET=&quot;${KEYCLOAK_SECRET}&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            export SPRING_DATASOURCE_PASSWORD=&quot;${SPRING_DATASOURCE_PASSWORD}&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            docker load &lt; clematis.mt.api.tar &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            docker compose -f docker-compose.yml build --build-arg KEYCLOAK_SECRET=&quot;${KEYCLOAK_SECRET}&quot; --build-arg SPRING_DATASOURCE_PASSWORD=&quot;${SPRING_DATASOURCE_PASSWORD}&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            docker compose -f docker-compose.yml up -d money-tracker-db money-tracker-db-demo &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            docker compose -f docker-compose.yml up -d --no-deps --build money-tracker-api money-tracker-api-demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/proxmox">proxmox</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/jenkins">jenkins</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-04T14:54:23.000Z" itemprop="dateModified">Aug 4, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Jenkins</div></a><a class="pagination-nav__link pagination-nav__link--next"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">React</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-from-a-lxc-template" class="table-of-contents__link toc-highlight">Install From a LXC Template</a></li><li><a href="#install-docker" class="table-of-contents__link toc-highlight">Install Docker</a></li><li><a href="#generate-ssh-key-pair-for-yoda" class="table-of-contents__link toc-highlight">Generate SSH Key Pair for Yoda</a></li><li><a href="#migrate-data" class="table-of-contents__link toc-highlight">Migrate Data</a></li><li><a href="#install-ssh-private-key-in-jenkins" class="table-of-contents__link toc-highlight">Install SSH Private Key in Jenkins</a></li><li><a href="#update-pipelines" class="table-of-contents__link toc-highlight">Update Pipelines</a><ul><li><a href="#pipeline-with-variables" class="table-of-contents__link toc-highlight">Pipeline With Variables</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/docs/web-applications">Web Applications</a></li><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/docs/recipe-book/react/props-and-state">Recipe Book</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">All Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/grauds/clematis.storage.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Clematis Storage API<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.weather.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Clematis Weather API<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/money.tracker.ui" target="_blank" rel="noopener noreferrer" class="footer__link-item">Money Tracker UI<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/money.tracker.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Money Tracker API<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.poc.pomodoro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pomodoro<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.cosmic.ui" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmic UI<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.cosmic" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmic API<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/grauds" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.desktop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Java Workspace<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Clematis. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>