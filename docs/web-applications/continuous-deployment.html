<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-web-applications/continuous-deployment/continuous-deployment" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Continuous Deployment | Clematis Explained</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://clematis.github.com/clematis.doc/img/clematis_small.svg"><meta data-rh="true" name="twitter:image" content="https://clematis.github.com/clematis.doc/img/clematis_small.svg"><meta data-rh="true" property="og:url" content="https://clematis.github.com/clematis.doc/docs/web-applications/continuous-deployment"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Continuous Deployment | Clematis Explained"><meta data-rh="true" name="description" content="The web projects described above, their client and server parts, are"><meta data-rh="true" property="og:description" content="The web projects described above, their client and server parts, are"><link data-rh="true" rel="icon" href="/clematis.doc/img/clematis_small.svg"><link data-rh="true" rel="canonical" href="https://clematis.github.com/clematis.doc/docs/web-applications/continuous-deployment"><link data-rh="true" rel="alternate" href="https://clematis.github.com/clematis.doc/docs/web-applications/continuous-deployment" hreflang="en"><link data-rh="true" rel="alternate" href="https://clematis.github.com/clematis.doc/docs/web-applications/continuous-deployment" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/clematis.doc/blog/rss.xml" title="Clematis Explained RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/clematis.doc/blog/atom.xml" title="Clematis Explained Atom Feed"><link rel="stylesheet" href="/clematis.doc/assets/css/styles.09018488.css">
<script src="/clematis.doc/assets/js/runtime~main.628f5f08.js" defer="defer"></script>
<script src="/clematis.doc/assets/js/main.e10d4c63.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/clematis.doc/"><div class="navbar__logo"><img src="/clematis.doc/img/clematis_small.svg" alt="Clematis Docs Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/clematis.doc/img/clematis_small.svg" alt="Clematis Docs Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Clematis Explained</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/clematis.doc/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/clematis.doc/blog">Blog</a><a href="https://github.com/grauds" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/clematis.doc/docs/intro">Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/clematis.doc/docs/web-applications">Web Applications</a><button aria-label="Collapse sidebar category &#x27;Web Applications&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/wireframes">Wireframes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/module-bundlers">Module Bundlers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/code-standards">Code Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/cucumber-playwright">Cucumber And Playwright</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/styling">Styling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/components">Composable Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/state-management">State Management</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/clematis.doc/docs/web-applications/data-querying">Data Querying</a><button aria-label="Expand sidebar category &#x27;Data Querying&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/clematis.doc/docs/web-applications/testing">Frontend Testing</a><button aria-label="Expand sidebar category &#x27;Frontend Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/backend-api">Documenting Backend API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/server-application">Server Application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/more-code-standards">More Code Standards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/business-domain">Business Domain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/database-initialization">Database Initialization</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/clematis.doc/docs/web-applications/serving-data">Serving Data</a><button aria-label="Expand sidebar category &#x27;Serving Data&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/logging">Runtime Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/clematis.doc/docs/web-applications/backend-testing">Backend Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/clematis.doc/docs/web-applications/continuous-deployment">Continuous Deployment</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/clematis.doc/docs/recipe-book">Recipe Book</a><button aria-label="Expand sidebar category &#x27;Recipe Book&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/clematis.doc/docs/outro">What is a fullstack developer?</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/clematis.doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/clematis.doc/docs/web-applications"><span itemprop="name">Web Applications</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Continuous Deployment</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Continuous Deployment</h1></header>
<p>The web projects described above, their client and server parts, are
built and packed into <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker</a> images. Each project has a Docker file
in the root of the project; however, not all the Docker build files
have a build stage, some of them just copy the built artifact.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It is preferable to have a Docker build stage for every project. It allows
avoiding fragile builds and dependencies on build environments.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="docker-images">Docker Images<a href="#docker-images" class="hash-link" aria-label="Direct link to Docker Images" title="Direct link to Docker Images">​</a></h2>
<p>Docker images for java applications use <code>openjdk:17-jdk-slim</code> and
web applications usually go with <code>node:16</code>, <code>node:18</code>,
<code>nginx:1.xx-alpine</code> or <code>openresty/openresty:alpine-fat</code>,
since they need either <a href="https://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a>,
<a href="https://openresty.org/en/" target="_blank" rel="noopener noreferrer">OpenResty</a>
or <a href="https://nginx.org/en/" target="_blank" rel="noopener noreferrer">Nginx</a>
to serve the static minified code files.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions">GitHub Actions<a href="#github-actions" class="hash-link" aria-label="Direct link to GitHub Actions" title="Direct link to GitHub Actions">​</a></h2>
<p>If either PR is merged to GitHub repository&#x27;s master or main branch
or code directly pushed to it, an automatic rebuild to renew the project
status badge will be triggered. The latter, of course, should not happen if
the number of developers in the project is greater than one.</p>
<p>Actions use Docker build files provided in the root of each project plus
a build procedure if the Docker file doesn&#x27;t have a build stage.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="jenkins-pipeline">Jenkins Pipeline<a href="#jenkins-pipeline" class="hash-link" aria-label="Direct link to Jenkins Pipeline" title="Direct link to Jenkins Pipeline">​</a></h2>
<p>At the same time, <a href="https://www.jenkins.io" target="_blank" rel="noopener noreferrer">Jenkins</a> is building projects
on the premise, using configured triggers or schedule.</p>
<img src="/clematis.doc/assets/images/jenkins-853ffe44831b57cbde4a6b64846605cb.png" style="width:500px" alt="">
<p>Each project has a <code>Jenkinsfile</code> at the root folder, the template is like below:</p>
<div class="language-jenkins codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">Jenkinsfile</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jenkins codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&quot;Verify tooling&quot;) {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  docker version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  docker info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  docker compose version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  curl --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  jq --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  docker compose ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Build docker image&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ENV_VARIABLE = credentials(&#x27;ENV_VARIABLE&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // actual build step</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&#x27;Publish tests&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                recordCoverage(tools: [[parser: &#x27;JACOCO&#x27;]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        id: &#x27;jacoco&#x27;, name: &#x27;JaCoCo Coverage&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sourceCodeRetention: &#x27;EVERY_BUILD&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        qualityGates: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                [threshold: 60.0, metric: &#x27;LINE&#x27;, baseline: &#x27;PROJECT&#x27;, unstable: true],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                [threshold: 60.0, metric: &#x27;BRANCH&#x27;, baseline: &#x27;PROJECT&#x27;, unstable: true]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage (&#x27;Dependency-Check&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dependencyCheck additionalArguments: &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -o &quot;./&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -s &quot;./&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    -f &quot;ALL&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    --prettyPrint&#x27;&#x27;&#x27;, nvdCredentialsId: &#x27;NVD_API_Key&#x27;, odcInstallation: &#x27;Dependency Checker&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dependencyCheckPublisher pattern: &#x27;dependency-check-report.xml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        stage(&quot;Build and start docker compose service&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ENV_VARIABLE = credentials(&#x27;ENV_VARIABLE&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker compose stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker stop [container] || true &amp;&amp; docker rm [container] || true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker compose build --build-arg ENV_VARIABLE=&#x27;$ENV_VARIABLE&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker compose up -d </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    post {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        always {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            junit skipPublishingChecks: true, testResults: &#x27;**/surefire/*.xml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li><strong>Verify tooling</strong>: a special preparation task to verify server build environment has everything installed</li>
<li><strong>Build docker image</strong>: a command to build the artifact locally. It usually contains an <code>environment</code> block to inject
build variables declared in Jenkins, like secrets, passwords, etc.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="coverage-report">Coverage Report<a href="#coverage-report" class="hash-link" aria-label="Direct link to Coverage Report" title="Direct link to Coverage Report">​</a></h3>
<ol start="3">
<li><strong>Publish tests</strong>: stage publishes the coverage of unit tests done during the previous stage to
Jenkins <a href="https://plugins.jenkins.io/coverage/" target="_blank" rel="noopener noreferrer">Coverage plugin</a>. All Java projects use <a href="https://www.eclemma.org/jacoco/" target="_blank" rel="noopener noreferrer">JaCoCo</a>
<a href="https://docs.gradle.org/current/userguide/jacoco_plugin.html" target="_blank" rel="noopener noreferrer">Gradle plugin</a>, all React or Angular projects
use <a href="https://cobertura.github.io/cobertura/" target="_blank" rel="noopener noreferrer">Cobertura</a> output, see the example below:</li>
</ol>
<div class="language-jenkins codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jenkins codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stage(&#x27;Publish tests&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sh &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       export DOCKER_BUILDKIT=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       docker build --output &quot;type=local,dest=${WORKSPACE}/coverage&quot; --target test-out .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ls -l ./coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    recordCoverage(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tools: [[parser: &#x27;COBERTURA&#x27;, pattern: &#x27;coverage/**/cobertura-coverage.xml&#x27;]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      id: &#x27;cobertura&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: &#x27;Cobertura Coverage&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sourceCodeRetention: &#x27;EVERY_BUILD&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ignoreParsingErrors: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      qualityGates: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [threshold: 60.0, metric: &#x27;LINE&#x27;, baseline: &#x27;PROJECT&#x27;, unstable: true],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [threshold: 60.0, metric: &#x27;BRANCH&#x27;, baseline: &#x27;PROJECT&#x27;, unstable: true]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vulnerabilities-report">Vulnerabilities Report<a href="#vulnerabilities-report" class="hash-link" aria-label="Direct link to Vulnerabilities Report" title="Direct link to Vulnerabilities Report">​</a></h3>
<ol start="4">
<li><strong>Dependency check</strong>: stage requires <a href="https://plugins.jenkins.io/dependency-check-jenkins-plugin/" target="_blank" rel="noopener noreferrer">Jenkins Dependency check</a>
plugin. This is an initiative led by <a href="https://owasp.org/#" target="_blank" rel="noopener noreferrer">OWASP</a> organization, and the plugin helps
to detect vulnerable libraries which need to be updated, both for Java and JavaScript projects. It is
advisable to get a <a href="https://nvd.nist.gov/" target="_blank" rel="noopener noreferrer">National Vulnerability Database (NVD)</a>
key from U.S. <a href="https://www.nist.gov/" target="_blank" rel="noopener noreferrer">National Institute Of Standards and Technology</a> for the plugin,
as it downloads the updates for the database much faster with <a href="https://nvd.nist.gov/developers/request-an-api-key" target="_blank" rel="noopener noreferrer">the key</a>.
The key should be stored as a secret in Jenkins and applied as in example above: <code>nvdCredentialsId: &#x27;NVD_API_Key&#x27;</code>.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="docker-compose-deployment">Docker Compose Deployment<a href="#docker-compose-deployment" class="hash-link" aria-label="Direct link to Docker Compose Deployment" title="Direct link to Docker Compose Deployment">​</a></h3>
<ol start="5">
<li><strong>Build and start docker compose service</strong>: the last stage is used to redeploy the application on the
same instance of Docker this Jenkins instance is running on. This environment is called <strong>staging</strong>
for all the projects.</li>
</ol>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Can be done better</div><div class="admonitionContent_BuS1"><p>There is nothing deployed to any cloud infrastructure at the moment, the migration will happen
as soon as time permits, since the <strong>staging</strong> environment is used for quality assurance testing
and user acceptance testing at the same time.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proxmox-hosted-vms">Proxmox Hosted VMs<a href="#proxmox-hosted-vms" class="hash-link" aria-label="Direct link to Proxmox Hosted VMs" title="Direct link to Proxmox Hosted VMs">​</a></h2>
<p>The on-premise environment is a standalone <a href="https://www.proxmox.com/en/" target="_blank" rel="noopener noreferrer">Proxmox</a> data center server installed
on the physical server with the following hardware:</p>
<ol>
<li>12 x Intel(R) Xeon(R) E-2336 CPU @ 2.90GHz (1 Socket)</li>
<li>RAM: 64Gb DDR4 3200MHz Samsung ECC Reg OEM</li>
<li>1Tb of M.2 SSD storage</li>
<li>7Tb of HDD storage for data, cache and interim backups</li>
</ol>
<p>Backups of virtual machine are also scheduled to another backup server with Proxmox Backup capabilities.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/express">express</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/openresty">openresty</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/nginx">nginx</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/jenkins">jenkins</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/cobertura">cobertura</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/jacoco">jacoco</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/coverage-plugin">coverage-plugin</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/docker">docker</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/docker-compose">docker-compose</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/clematis.doc/docs/tags/proxmox">proxmox</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/clematis.doc/docs/web-applications/backend-testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Backend Testing</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/clematis.doc/docs/recipe-book"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Recipe Book</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#docker-images" class="table-of-contents__link toc-highlight">Docker Images</a></li><li><a href="#github-actions" class="table-of-contents__link toc-highlight">GitHub Actions</a></li><li><a href="#jenkins-pipeline" class="table-of-contents__link toc-highlight">Jenkins Pipeline</a><ul><li><a href="#coverage-report" class="table-of-contents__link toc-highlight">Coverage Report</a></li><li><a href="#vulnerabilities-report" class="table-of-contents__link toc-highlight">Vulnerabilities Report</a></li><li><a href="#docker-compose-deployment" class="table-of-contents__link toc-highlight">Docker Compose Deployment</a></li></ul></li><li><a href="#proxmox-hosted-vms" class="table-of-contents__link toc-highlight">Proxmox Hosted VMs</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/docs/web-applications">Web Applications</a></li><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/docs/recipe-book/react/props-and-state">Recipe Book</a></li></ul></div><div class="col footer__col"><div class="footer__title">All Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/grauds/clematis.auth.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Clematis Auth API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.storage.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Clematis Storage API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.weather.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Clematis Weather API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/money.tracker.ui" target="_blank" rel="noopener noreferrer" class="footer__link-item">Money Tracker UI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/money.tracker.api" target="_blank" rel="noopener noreferrer" class="footer__link-item">Money Tracker API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.poc.pomodoro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pomodoro<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.cosmic.ui" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmic UI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.cosmic" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmic API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/clematis.doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/grauds" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/grauds/clematis.desktop" target="_blank" rel="noopener noreferrer" class="footer__link-item">Java Workspace<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Clematis. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>