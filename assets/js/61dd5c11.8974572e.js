"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[2478],{32517:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"web-applications/capabilities-sharing","title":"Sharing Capabilities","description":"Once a RESTful API is built, it can be used by the other RESTful APIs to combine data from other sources with","source":"@site/docs/web-applications/capabilities-sharing.md","sourceDirName":"web-applications","slug":"/web-applications/capabilities-sharing","permalink":"/clematis.doc/docs/web-applications/capabilities-sharing","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"feign","permalink":"/clematis.doc/docs/tags/feign"}],"version":"current","lastUpdatedAt":1763557646000,"sidebarPosition":18,"frontMatter":{"sidebar_position":18,"tags":["feign"]},"sidebar":"tutorialSidebar","previous":{"title":"Continuous Deployment","permalink":"/clematis.doc/docs/web-applications/continuous-deployment/"},"next":{"title":"Web Applications Security","permalink":"/clematis.doc/docs/web-applications-security/"}}');var a=t(74848),r=t(28453);const s={sidebar_position:18,tags:["feign"]},o="Sharing Capabilities",l={},c=[{value:"Storage API Feign Client",id:"storage-api-feign-client",level:2},{value:"Building the Client",id:"building-the-client",level:3},{value:"Using the Client in Another Project",id:"using-the-client-in-another-project",level:3}];function p(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"sharing-capabilities",children:"Sharing Capabilities"})}),"\n",(0,a.jsx)(n.p,{children:"Once a RESTful API is built, it can be used by the other RESTful APIs to combine data from other sources with\nthe data from the current database. For instance, Cosmic API and Money Tracker API can use\nClematis Storage API to store images and other files."}),"\n",(0,a.jsx)(n.h2,{id:"storage-api-feign-client",children:"Storage API Feign Client"}),"\n",(0,a.jsxs)(n.p,{children:["Following the tradition, the client for the Storage API is built\nwith ",(0,a.jsx)(n.a,{href:"https://docs.spring.io/spring-cloud-openfeign/docs/current/reference/html/",children:"Spring Cloud Open Feign"}),"."]}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsxs)(n.p,{children:["Spring recommends its own\n",(0,a.jsx)(n.a,{href:"https://docs.spring.io/spring-framework/reference/integration/rest-clients.html",children:"REST Clients"})," for new projects."]})}),"\n",(0,a.jsxs)(n.p,{children:["There is a GitHub repository with the client code:\n",(0,a.jsx)(n.a,{href:"https://github.com/grauds/clematis.storage.api.client",children:"Clematis Storage Feign Client"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"building-the-client",children:"Building the Client"}),"\n",(0,a.jsxs)(n.p,{children:["Since this is the most recent project, I've decided to use Kotlin for the Gradle build file to get better",(0,a.jsx)(n.br,{}),"\n","type safety and IDE support. The plugins are specific for a Spring Boot library project:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",metastring:'title="build.gradle.kts"',children:'plugins {\n    id("org.springframework.boot") version "3.3.5" apply false // do not apply this, it\'s a library\n    id("io.spring.dependency-management") version "1.1.6"\n    id("java-library")\n    id("checkstyle")\n    id("maven-publish")\n}\n\n// Apply Spring Boot dependency management without applying the full Spring Boot plugin\n// This ensures we get all the version management without the application packaging features\napply(plugin = "io.spring.dependency-management")\n'})}),"\n",(0,a.jsx)(n.p,{children:"Then the library uses a starter to configure the Feign client:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-kotlin",metastring:'title="build.gradle.kts"',children:'dependencies {\n    implementation("org.springframework.cloud:spring-cloud-starter-openfeign")\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The Java code example is below:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",metastring:'title="java/com/github/grauds/clematis/storage/api/client/StorageApiClient.java"',children:'@FeignClient(\n    name = "storageApiClient",\n    url = "${storage.api.url}"\n)\npublic interface StorageApiClient {\n// ...\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The variable ",(0,a.jsx)(n.code,{children:"storage.api.url"})," has to be defined in the ",(0,a.jsx)(n.code,{children:"application.yml"})," file in the library to test it, and\nin the project that uses the client (see below)."]}),"\n",(0,a.jsx)(n.h3,{id:"using-the-client-in-another-project",children:"Using the Client in Another Project"}),"\n",(0,a.jsxs)(n.p,{children:["The library is published to GitHub Packages, so it can be used in other projects as a dependency.\nNode that the credentials for accessing the GitHub Packages are required, so they can be placed in a file\nor environment variables. The example of the ",(0,a.jsx)(n.code,{children:"build.gradle"})," file for the project\nwith a Storage API client is below:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-gradle",metastring:'title="build.gradle"',children:"plugins {\n   id 'org.springframework.boot' version '3.3.5' // keep in sync with Spring Cloud (we use Feign)\n}\n\n// load GitHub credentials from file or environment variables\nif (file('config/build/github.env').exists()) {\n    Properties properties = new Properties()\n    file('config/build/github.env').withInputStream { properties.load(it) }\n    ext.username = properties.getProperty('USERNAME')\n    ext.token = properties.getProperty('TOKEN')\n} else {\n    ext.username = System.getenv(\"USERNAME\")\n    ext.token = System.getenv(\"TOKEN\")\n}\n\nrepositories {\n    mavenCentral()\n    maven {\n        name = \"GitHubPackages\"\n        url = URI.create(\"https://maven.pkg.github.com/grauds/clematis.storage.api.client\")\n        credentials {\n            username = project.ext.username\n            password = project.ext.token\n        }\n    }\n}\n\ndependencies {\n   implementation 'com.github.grauds:clematis.storage.api.client:1.0.2'\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"The client then can be used in the project as follows, for example, for downloading a file. This\nmight not be the best way to demo the usage, since the client can just use the direct link to\nthe Storage API. However, in case if Cosmic API wants to add something in between or transform the response,\nit can be used:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",metastring:'title="java/org/clematis/cosmic/web/StorageController.java"',children:'@RestController\n@RequestMapping("/api/storage")\npublic class StorageController {\n\n    // ...\n        \n    private final StorageApiClient storageApiClient;\n\n    public StorageController(StorageApiClient storageApiClient) {\n        this.storageApiClient = storageApiClient;\n    }\n    \n    /**\n     * Download a file by its full path (as stored in the storage system).\n     */\n    @GetMapping("/files/download")\n    public ResponseEntity<byte[]> downloadFile(\n        @RequestParam("id") String id\n    ) {\n        byte[] content = storageApiClient.getFile(id).getBody();\n\n        HttpHeaders headers = new HttpHeaders();\n        headers.setContentType(MediaType.APPLICATION_OCTET_STREAM);\n        return new ResponseEntity<>(content, headers, HttpStatus.OK);\n    }\n    // ...\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The target URL variable has to be defined in the ",(0,a.jsx)(n.code,{children:"application.yml"})," file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"storage:\n  api:\n    url: http://localhost:8081/api/storage\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Useful article on Medium ",(0,a.jsx)(n.a,{href:"https://medium.com/@AlexanderObregon/how-spring-boot-implements-feign-clients-for-rest-apis-8a4108fa248c",children:"How Spring Boot Implements Feign Clients for REST APIs"})]})})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);