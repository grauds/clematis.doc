"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[5437],{94057:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"web-applications/data-querying/money-tracker","title":"Money Tracker Data Exchange","description":"Dependency Injection (DI)","source":"@site/docs/web-applications/data-querying/money-tracker.md","sourceDirName":"web-applications/data-querying","slug":"/web-applications/data-querying/money-tracker","permalink":"/clematis.doc/docs/web-applications/data-querying/money-tracker","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"fetch_api","permalink":"/clematis.doc/docs/tags/fetch-api"},{"inline":true,"label":"xml_http_request","permalink":"/clematis.doc/docs/tags/xml-http-request"},{"inline":true,"label":"dependency_injection","permalink":"/clematis.doc/docs/tags/dependency-injection"},{"inline":true,"label":"hateoas","permalink":"/clematis.doc/docs/tags/hateoas"},{"inline":true,"label":"ngx-hateoas-client","permalink":"/clematis.doc/docs/tags/ngx-hateoas-client"},{"inline":true,"label":"observables","permalink":"/clematis.doc/docs/tags/observables"}],"version":"current","lastUpdatedAt":1742201711000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["fetch_api","xml_http_request","dependency_injection","hateoas","ngx-hateoas-client","observables"]},"sidebar":"tutorialSidebar","previous":{"title":"Data Querying","permalink":"/clematis.doc/docs/web-applications/data-querying/"},"next":{"title":"Pomodoro / Reddit Thunks","permalink":"/clematis.doc/docs/web-applications/data-querying/pomodoro"}}');var i=t(74848),a=t(28453);const r={sidebar_position:1,tags:["fetch_api","xml_http_request","dependency_injection","hateoas","ngx-hateoas-client","observables"]},o="Money Tracker Data Exchange",c={},l=[{value:"Dependency Injection (DI)",id:"dependency-injection-di",level:2},{value:"HTTP Client",id:"http-client",level:2},{value:"Typed Responses",id:"typed-responses",level:2},{value:"A Special Library For Hypermedia Resources",id:"a-special-library-for-hypermedia-resources",level:2},{value:"The Service Layer",id:"the-service-layer",level:2},{value:"The Hypermedia Service",id:"the-hypermedia-service",level:2},{value:"RxJS Observables In Stateful Components",id:"rxjs-observables-in-stateful-components",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"money-tracker-data-exchange",children:"Money Tracker Data Exchange"})}),"\n",(0,i.jsx)(n.h2,{id:"dependency-injection-di",children:"Dependency Injection (DI)"}),"\n",(0,i.jsx)(n.p,{children:"It is worth mentioning Angular Dependency Injection (DI) before proceeding with\ndata exchange with server side. The services which talk to servers are injected into components\nin constructor arguments, for example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'jsx title="libs/shared-components/src/lib/components/entity-list/entity-list.component.ts"',children:"@Component({\n    selector: 'app-entity-list',\n    templateUrl: './entity-list.component.html',\n    styleUrls: ['./entity-list.component.sass']\n})\nexport class EntityListComponent<T extends Entity> implements OnInit {\n    \n    public constructor(@Inject(\"searchService\") private readonly searchService: SearchService<T>,\n        protected router: Router,\n        protected route: ActivatedRoute) {\n        \n    }\n    \n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The keyword ",(0,i.jsx)(n.code,{children:"private"})," here automatically creates a private field and assigns the value,\nno need to create the field for the autowired value manually. Otherwise, if the field has to have a different\nvisibility scope, the ",(0,i.jsx)(n.code,{children:"private"})," keyword has to be omitted."]}),"\n",(0,i.jsx)(n.admonition,{title:"More info on DI",type:"info",children:(0,i.jsxs)(n.p,{children:["Check documentation at ",(0,i.jsx)(n.a,{href:"https://angular.dev/guide/di",children:"Angular Dev"})," for dependency injection\ndetails."]})}),"\n",(0,i.jsx)(n.h2,{id:"http-client",children:"HTTP Client"}),"\n",(0,i.jsx)(n.p,{children:"The module is imported on application layer and libraries which need HTTP Client automatically\nfind it imported if they are used with the application:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/src/app/app.module.ts"',children:"import { HttpClientModule } from '@angular/common/http';\n\n@NgModule({\n    declarations: [\n        //..   \n    ],\n    imports: [\n        HttpClientModule\n    ]\n})\n"})}),"\n",(0,i.jsx)(n.admonition,{title:"Can be improved",type:"tip",children:(0,i.jsxs)(n.p,{children:["The newer versions of Angular offer a different way to\n",(0,i.jsx)(n.a,{href:"https://angular.dev/guide/http/setup#httpclientmodule-based-configuration",children:"configure HTTP Client"}),"."]})}),"\n",(0,i.jsx)(n.admonition,{title:"Can use better low level API",type:"info",children:(0,i.jsxs)(n.p,{children:["By default, HttpClient uses the ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest",children:"XMLHttpRequests"}),"\nto make requests. The withFetch feature switches the client to use the ",(0,i.jsx)(n.a,{href:"https://www.w3schools.com/js/js_api_fetch.asp",children:"fetch API"}),"\ninstead."]})}),"\n",(0,i.jsx)(n.h2,{id:"typed-responses",children:"Typed Responses"}),"\n",(0,i.jsxs)(n.p,{children:["Fetching data from the backend requires classes to get JSON parsed in a typed manner, and there are\ntwo kinds of such classes in the project's ",(0,i.jsx)(n.code,{children:"model"})," library."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Data Transfer Objects for generic responses like in report endpoints and others,\nnot obeying ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/HATEOAS",children:"REST Hateoas"})," contract in ",(0,i.jsx)(n.code,{children:"libs/model/src/dto"})," directory."]}),"\n",(0,i.jsxs)(n.li,{children:["Entity classes for working with REST Hateoas resources in ",(0,i.jsx)(n.code,{children:"libs/model/src/model"})," directory."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"a-special-library-for-hypermedia-resources",children:"A Special Library For Hypermedia Resources"}),"\n",(0,i.jsxs)(n.p,{children:["Working with Hypermedia resources is much easier with this special client library, which understands the responses and\ncan deduce the URLs of the endpoint: ",(0,i.jsx)(n.a,{href:"https://github.com/lagoshny/ngx-hateoas-client",children:"ngx-hateoas-client"}),".\nEach entity class has a special decorator ",(0,i.jsx)(n.a,{href:"https://github.com/lagoshny/ngx-hateoas-client",children:"@HateoasResource"})," which announces\nthe corresponding endpoint:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="libs/model/src/model/account-balance.ts"',children:"import { HateoasResource } from '@lagoshny/ngx-hateoas-client';\nimport { Entity } from './entity';\n\n@HateoasResource('accountsTotals')\nexport class AccountBalance extends Entity {\n\n  balance = 0;\n\n  code = '';\n\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"As per documentation, it is required to mark your resource\nclasses with this decorator otherwise you will get an error when performing resource request."}),"\n",(0,i.jsxs)(n.p,{children:["For Money Tracker, ",(0,i.jsx)(n.code,{children:"Entity"})," is a base class for all Hateoas resources and it is itself\nhas a base class ",(0,i.jsx)(n.code,{children:"Resource"})," from ",(0,i.jsx)(n.code,{children:"@lagoshny/ngx-hateoas-client/lib/model/resource/resource.d.ts"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="libs/model/src/model/entity.ts"',children:"import { Resource } from '@lagoshny/ngx-hateoas-client';\n\nexport class Entity extends Resource {\n\n  name: string | undefined;\n\n //..\n}\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"The base class is responsible for dealing with other resources and collection of\nresource relations during data exchange behind the scenes."}),"\n",(0,i.jsx)(n.h2,{id:"the-service-layer",children:"The Service Layer"}),"\n",(0,i.jsx)(n.p,{children:"It is enough to have a special decorator for a class to become a service; the main\ncondition is that the future service has to be injectable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/src/app/about/about.component.ts"',children:"import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\n@Injectable()\nexport class StatsService {\n\n  constructor(\n    private readonly http: HttpClient,\n  ) {\n      //..\n  }\n\n  getIncomeTransactionsCount(): Observable<InfoAbout> {\n      return this.http.get<InfoAbout>('/about');\n  }\n}\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Also, it has to have ",(0,i.jsx)(n.code,{children:"HttpClient"})," injected to make HTTP calls to backend. That's all.\nThen the service in turn is injected into a stateful component:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/src/app/about/about.component.ts"',children:"@Component({\n    selector: 'app-about',\n    templateUrl: './about.component.html',\n    styleUrls: ['./about.component.sass'],\n})\nexport class AboutComponent implements OnInit {\n\n    infoAbout: InfoAbout | undefined;\n    \n    constructor(private readonly statsService: StatsService) {\n        //..\n    }\n\n    ngOnInit(): void {\n        this.title.setTitle('Money Tracker - About');\n        this.loadData();\n    }\n    \n    loadData() {\n        this.statsService.getIncomeTransactionsCount().subscribe(infoAbout => {\n            this.infoAbout = infoAbout;\n        });\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then the data is loaded on component initialization,\nsee ",(0,i.jsx)(n.a,{href:"https://angular.dev/guide/components/lifecycle#",children:"Angular Components Lifecycle"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"the-hypermedia-service",children:"The Hypermedia Service"}),"\n",(0,i.jsxs)(n.p,{children:["There is a special service ",(0,i.jsx)(n.code,{children:"HateoasResourceService"})," for Hateoas resource which understands\n",(0,i.jsx)(n.code,{children:"Resource"})," decorators of\nentity classes and provides a wide range of related functions for\nhandling Hypermedia links. Application injects service described above and\nuses it in a typesafe manner as the class is generic. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="libs/shared-components/src/lib/service/accounts.service.ts"',children:'import { \n    HateoasResourceService,\n    PagedResourceCollection,\n    ResourceCollection\n} from "@lagoshny/ngx-hateoas-client";\n\n@Injectable()\nexport class AccountsService {\n\n    constructor(private http: HttpClient,\n                private hateoasService: HateoasResourceService) {\n        //..\n    }\n\n    searchPage(options: PagedGetOption | undefined, queryName: string):\n        Observable<PagedResourceCollection<AccountBalance>> {\n        return this.hateoasService.searchPage<AccountBalance>(AccountBalance, queryName, options);\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The method ",(0,i.jsx)(n.code,{children:"searchPage"})," is using some additional classes to parse pages resource\ncollections returned by the backend."]}),"\n",(0,i.jsx)(n.h2,{id:"rxjs-observables-in-stateful-components",children:"RxJS Observables In Stateful Components"}),"\n",(0,i.jsxs)(n.p,{children:["The components which exchange data with servers contain ",(0,i.jsx)(n.a,{href:"https://rxjs.dev/guide/observable",children:(0,i.jsx)("i",{children:"RxJS observable"})})," fields allowing\nclients to update rendered user interface as the data changes."]}),"\n",(0,i.jsx)(n.admonition,{title:"More info on RxJS",type:"info",children:(0,i.jsxs)(n.p,{children:["This part of client data flow in Angular is tightly coupled\nwith ",(0,i.jsx)(n.a,{href:"https://rxjs.dev/",children:"Reactive Extensions Library for JavaScript"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);