"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[7717],{79121:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"web-applications/module-bundlers","title":"Module Bundlers","description":"Money Tracker","source":"@site/docs/web-applications/module-bundlers.md","sourceDirName":"web-applications","slug":"/web-applications/module-bundlers","permalink":"/clematis.doc/docs/web-applications/module-bundlers","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"webpack","permalink":"/clematis.doc/docs/tags/webpack"},{"inline":true,"label":"vite","permalink":"/clematis.doc/docs/tags/vite"},{"inline":true,"label":"spa","permalink":"/clematis.doc/docs/tags/spa"},{"inline":true,"label":"ssr","permalink":"/clematis.doc/docs/tags/ssr"},{"inline":true,"label":"esbuild","permalink":"/clematis.doc/docs/tags/esbuild"}],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["webpack","vite","spa","ssr","esbuild"]},"sidebar":"tutorialSidebar","previous":{"title":"Wireframes","permalink":"/clematis.doc/docs/web-applications/wireframes/"},"next":{"title":"Code Standards","permalink":"/clematis.doc/docs/web-applications/code-standards"}}');var r=s(74848),i=s(28453);const o={sidebar_position:3,tags:["webpack","vite","spa","ssr","esbuild"]},a="Module Bundlers",l={},c=[{value:"Money Tracker",id:"money-tracker",level:2},{value:"Application Configuration",id:"application-configuration",level:3},{value:"Library Configuration",id:"library-configuration",level:3},{value:"Pomodoro",id:"pomodoro",level:2},{value:"Webpack And Server Side Rendering",id:"webpack-and-server-side-rendering",level:3},{value:"Express Web Framework",id:"express-web-framework",level:3},{value:"Server HTML Index Template",id:"server-html-index-template",level:3},{value:"Server Rendering Configuration",id:"server-rendering-configuration",level:3},{value:"Client Rendering Configuration",id:"client-rendering-configuration",level:3},{value:"Project Layout",id:"project-layout",level:3},{value:"Cosmic",id:"cosmic",level:2},{value:"Vite Configuration",id:"vite-configuration",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"module-bundlers",children:"Module Bundlers"})}),"\n",(0,r.jsx)(n.h2,{id:"money-tracker",children:"Money Tracker"}),"\n",(0,r.jsxs)(n.p,{children:["Nowadays, Angular or Nx both use\n",(0,r.jsx)(n.a,{href:"https://esbuild.github.io",children:"esbuild"})," by default. For Money Tracker application,\nhowever, build is done with ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@angular-devkit/build-angular",children:(0,r.jsx)(n.code,{children:"@angular-devkit/build-angular:browser"})}),"\nwhich uses ",(0,r.jsx)(n.a,{href:"https://webpack.js.org/",children:"Webpack"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Can Be Done Better",type:"tip",children:(0,r.jsxs)(n.p,{children:["Angular team in turn encourages to\nuse the ",(0,r.jsx)(n.a,{href:"https://angular.dev/tools/cli/build-system-migration#",children:"new build system"}),"."]})}),"\n",(0,r.jsx)(n.h3,{id:"application-configuration",children:"Application Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Each module in mono-repository has ",(0,r.jsx)(n.code,{children:"project.json"})," file where build configuration\ncan also be specified in the corresponding section:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:'title="apps/money-tracker-ui/project.json"',children:'{\n   "build": {\n      "executor": "@angular-devkit/build-angular:browser",\n      "outputs": ["{options.outputPath}"],\n      "options": {\n        "outputPath": "dist/apps/money-tracker-ui",\n        "index": "apps/money-tracker-ui/src/index.html",\n        "main": "apps/money-tracker-ui/src/main.ts",\n        "polyfills": "apps/money-tracker-ui/src/polyfills.ts",\n        "tsConfig": "apps/money-tracker-ui/tsconfig.app.json",\n        "inlineStyleLanguage": "sass",\n        "assets": [\n          "apps/money-tracker-ui/src/favicon.ico",\n          "apps/money-tracker-ui/src/assets"\n        ],\n        "styles": [\n          "./node_modules/@angular/material/prebuilt-themes/indigo-pink.css",\n          "apps/money-tracker-ui/src/styles.css",\n          "apps/money-tracker-ui/src/styles.sass"\n        ],\n        "scripts": [],\n        "allowedCommonJsDependencies": ["keycloak-js", "base64-js", "js-sha256"]\n      },\n      "configurations": {\n        "default": {\n          "budgets": [\n            {\n              "type": "initial",\n              "maximumWarning": "5mb",\n              "maximumError": "15mb"\n            },\n            {\n              "type": "anyComponentStyle",\n              "maximumWarning": "2kb",\n              "maximumError": "4kb"\n            }\n          ],\n          "outputHashing": "all"\n        }\n      },\n      "defaultConfiguration": "default"\n    }\n\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"library-configuration",children:"Library Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Build executors for libraries are different, for example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "build": {\n    "executor": "@nx/angular:package",\n    "outputs": [\n      "{workspaceRoot}/dist/{projectRoot}"\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"pomodoro",children:"Pomodoro"}),"\n",(0,r.jsx)(n.p,{children:"Pomodoro is configured to use Server Side Rendering just to demo the approach,\nsince the application is not only the timer, but mostly a sandbox for React/Webpack stack."}),"\n",(0,r.jsx)(n.h3,{id:"webpack-and-server-side-rendering",children:"Webpack And Server Side Rendering"}),"\n",(0,r.jsxs)(n.p,{children:["Server Side Rendering (SSR) is configured by ",(0,r.jsx)(n.a,{href:"https://webpack.js.org/",children:"Webpack 5"})," for Pomodoro.\nThere are a few packages that need to be installed first:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "dependencies": {\n    "compression": "^1.7.4",\n    "express": "^4.21.0",\n    "helmet": "^7.1.0",\n    "react-dom": "^17.0.2" \n  },\n  "devDependencies": {\n    "clean-webpack-plugin": "^4.0.0",\n    "html-webpack-plugin": "^4.5.2",\n    "webpack": "^5.97.1",\n    "webpack-cli": "^5.1.4",\n    "webpack-dev-middleware": "^3.7.3",\n    "webpack-dev-server": "^3.11.3",\n    "webpack-hot-middleware": "^2.26.1"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"The configuration file is:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="webpack.config.js"',children:"const webpackClientConfig = require('./cfg/webpack.client.config');\nconst webpackServerConfig = require('./cfg/webpack.server.config');\n\nmodule.exports = [webpackClientConfig, webpackServerConfig];\n"})}),"\n",(0,r.jsx)(n.p,{children:"It just includes two more webpack configuration files, one for a client and another for a server\nand returns joint configuration in a tuple."}),"\n",(0,r.jsx)(n.h3,{id:"express-web-framework",children:"Express Web Framework"}),"\n",(0,r.jsxs)(n.p,{children:["Pomodoro uses ",(0,r.jsx)(n.a,{href:"https://expressjs.com/",children:"express 4"})," to serve rendered HTML to clients:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:'title="src/server/server.js"',children:"import express from 'express';\nimport ReactDOM from 'react-dom/server';\nimport compression from 'compression';\nimport helmet from 'helmet';\n\nimport { App } from '@/App';\n\nimport { indexTemplate } from './indexTemplate';\n\nconst app = express();\n\nconst PORT = process.env.PORT || 3000;\n\napp.use('/static', express.static('./dist/client'));\n\napp.use(compression());\napp.use(\n  helmet({\n    contentSecurityPolicy: false,\n  }),\n);\n\napp.get('*', (req, res) => {\n  res.send(indexTemplate(ReactDOM.renderToString(App())));\n});\n\napp.listen(PORT, () => {\n  console.log(`Server started on http://localhost:${PORT}`);\n});\n\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Express"})," server uses ",(0,r.jsx)(n.a,{href:"https://react.dev/reference/react-dom/server/renderToString",children:(0,r.jsx)(n.code,{children:"ReactDOM.renderToString(App())"})}),"\nto get HTML to be sent and to be hydrated later on the client side, also\nit uses ",(0,r.jsx)(n.a,{href:"https://expressjs.com/en/resources/middleware/compression.html",children:(0,r.jsx)(n.code,{children:"compression"})}),"\nmiddleware to gzip the response and ",(0,r.jsx)(n.a,{href:"https://github.com/helmetjs/helmet",children:(0,r.jsx)(n.code,{children:"helmet"})}),"\nmiddleware to disable ",(0,r.jsx)(n.code,{children:"Content-Security-Policy"})," in our case."]}),"\n",(0,r.jsx)(n.h3,{id:"server-html-index-template",children:"Server HTML Index Template"}),"\n",(0,r.jsxs)(n.p,{children:["It's a JavaScript file that exports a basic HTML file with placeholder for\nReact rendered content, see line ",(0,r.jsx)(n.code,{children:" res.send(indexTemplate(ReactDOM.renderToString(App())))"}),"\nabove:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="src/server/indexTemplate.js"',children:'export const indexTemplate = (content) => `\n<!DOCTYPE html>\n<html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Pomodoro</title>\n        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\ud83c\udf45</text></svg>">\n        <script src="/static/client.js" type="application/javascript"><\/script>\n    </head>\n    <body>\n      <div id="react_root">${content}</div>\n      <div id="modal_root"></div>\n    </body>\n</html>\n`;\n'})}),"\n",(0,r.jsx)(n.h3,{id:"server-rendering-configuration",children:"Server Rendering Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Webpack configuration for the server side is used to actually produce the HTML which is\nmentioned above. Is uses ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/webpack-node-externals",children:(0,r.jsx)(n.code,{children:"webpack-node-externals"})}),"\nto exclude node modules from the output, obviously, they are included on the client side\nto be downloaded once, not with every page request from the server:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="cfg/webpack.server.config.js"',children:"/* eslint-disable @typescript-eslint/no-var-requires */\nconst path = require('path');\nconst { DefinePlugin } = require('webpack');\nconst nodeExternals = require('webpack-node-externals');\n\nconst NODE_ENV = process.env.NODE_ENV;\nconst GLOBAL_CSS_REGEXP = /\\.global\\.css$/;\nconst COMMON_PLUGINS = [\n    new DefinePlugin({ 'process.env.CLIENT_ID': `'${process.env.CLIENT_ID}'` }),\n];\n\nmodule.exports = {\n    target: 'node',\n    mode: NODE_ENV || 'development',\n    entry: path.resolve(__dirname, '../src/server/server.js'),\n    output: {\n        path: path.resolve(__dirname, '../dist/server'),\n        filename: 'server.js',\n    },\n    resolve: {\n        extensions: ['.js', '.jsx', '.ts', '.tsx', '.json'],\n        alias: {\n            '@/*': path.resolve(__dirname, '../src/*'),\n        },\n    },\n    externals: [nodeExternals()],\n    module: {\n        rules: [\n            {\n                test: /\\.[tj]sx?$/,\n                use: ['ts-loader'],\n            },\n            {\n                test: /\\.css$/,\n                use: [\n                    {\n                        loader: 'css-loader',\n                        options: {\n                            modules: {\n                                mode: 'local',\n                                localIdentName: '[name]__[local]--[hash:base64:5]',\n                            },\n                            onlyLocals: true,\n                        },\n                    },\n                ],\n                exclude: GLOBAL_CSS_REGEXP,\n            },\n            {\n                test: /\\.less$/,\n                use: [\n                    {\n                        loader: 'css-loader',\n                        options: {\n                            modules: {\n                                mode: 'local',\n                                localIdentName: '[name]__[local]--[hash:base64:5]',\n                            },\n                            onlyLocals: true,\n                        },\n                    },\n                    'less-loader',\n                ],\n            },\n            {\n                test: GLOBAL_CSS_REGEXP,\n                use: ['css-loader'],\n            },\n            {\n                test: /\\.(ogg|mp3|wav|mpe?g)$/i,\n                loader: 'file-loader',\n                options: {\n                    name: '[path][name].[ext]',\n                },\n            },\n        ],\n    },\n    optimization: {\n        minimize: false,\n    },\n    plugins: COMMON_PLUGINS,\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"client-rendering-configuration",children:"Client Rendering Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Client code is contained in one file below and only does one thing;\nit is ",(0,r.jsx)(n.a,{href:"https://18.react.dev/reference/react-dom/hydrate#hydrating-server-rendered-html",children:"hydrating"}),"\nHTML that has been produced by server-side React environment:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:'jsx title="src/client/index.jsx"',children:"import * as React from 'react';\nimport * as ReactDom from 'react-dom';\nimport { App } from '@/App';\n\nwindow.addEventListener('load', () => {\n  ReactDom.hydrate(<App />, document.getElementById('react_root'));\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Webpack configuration file for the client side is similar for the server side,\nexcept for it adds ",(0,r.jsx)(n.code,{children:"webpack-hot-middleware"})," and ",(0,r.jsx)(n.code,{children:"style-loader"})," plugins,\nwhich are not necessary on the server, since they are needed for visual representation\nof the layout and for work in browsers."]}),"\n",(0,r.jsxs)(n.p,{children:["Also, there is a DEV/PROD switch (from ",(0,r.jsx)(n.code,{children:"process.env.NODE_ENV"}),") configured as well:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="cfg/webpack.client.config.js"',children:"/* eslint-disable @typescript-eslint/no-var-requires */\nconst path = require('path');\nconst { HotModuleReplacementPlugin, DefinePlugin } = require('webpack');\nconst { CleanWebpackPlugin } = require('clean-webpack-plugin');\n\nconst NODE_ENV = process.env.NODE_ENV;\nconst IS_DEV = NODE_ENV === 'development';\nconst IS_PROD = NODE_ENV === 'production';\n//..\nconst DEV_PLUGINS = [\n  new CleanWebpackPlugin(),\n  new HotModuleReplacementPlugin(),\n];\nconst COMMON_PLUGINS = [\n  new DefinePlugin({ 'process.env.CLIENT_ID': `'${process.env.CLIENT_ID}'` }),\n];\n\nfunction setupDevtool() {\n  if (IS_DEV) {\n    return 'eval';\n  }\n\n  if (IS_PROD) {\n    return false;\n  }\n}\n\nfunction getEntry() {\n  if (IS_PROD) {\n    return [path.resolve(__dirname, '../src/client/index.jsx')];\n  }\n // adding HMR support for development configuration\n  return [\n    path.resolve(__dirname, '../src/client/index.jsx'),\n    'webpack-hot-middleware/client?path=http://localhost:3001/static/__webpack_hmr',\n  ];\n}\n\nmodule.exports = {\n  resolve: {\n    extensions: ['.js', '.jsx', '.ts', '.tsx', '.json'],\n    alias: {\n      'react-dom': IS_DEV ? '@hot-loader/react-dom' : 'react-dom',\n      '@/*': path.resolve(__dirname, '../src/*'),\n    },\n  },\n  mode: NODE_ENV || 'development',\n  entry: getEntry(),\n  output: {\n    path: path.resolve(__dirname, '../dist/client'),\n    filename: 'client.js',\n    publicPath: '/static/',\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.[tj]sx?$/,\n        use: ['ts-loader'],\n      },\n      //..\n      {\n        test: /\\.less$/,\n        use: [\n          'style-loader',\n          {\n            loader: 'css-loader',\n            options: {\n              modules: {\n                mode: 'local',\n                localIdentName: '[name]__[local]--[hash:base64:5]',\n              },\n            },\n          },\n          'less-loader',\n        ],\n      },\n      {\n        test: GLOBAL_CSS_REGEXP,\n        use: ['style-loader', 'css-loader'],\n      }\n      //..\n    ],\n  },\n  devtool: setupDevtool(),\n  plugins: IS_DEV ? DEV_PLUGINS.concat(COMMON_PLUGINS) : COMMON_PLUGINS,\n};\n\n"})}),"\n",(0,r.jsx)(n.h3,{id:"project-layout",children:"Project Layout"}),"\n",(0,r.jsx)(n.p,{children:"This is a short version of the full layout:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"client"})," folder contains code only for client side."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"server"})," folder is for server side."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"shared"})," folder contains code for both; this is where components are put."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"src\n \u251c\u2500 client\n \u2502 \u2514\u2500 index.jsx\n \u251c\u2500 server\n \u2502 \u251c\u2500 indexTemplate.js\n \u2502 \u2514\u2500 server.js\n \u251c\u2500 shared\n \u2502 \u251c\u2500 Header\n \u2502 \u2502 \u251c\u2500 Stats\n \u2502 \u2502 \u251c\u2500 Title\n \u2502 \u2502 \u251c\u2500 __tests__\n \u2502 \u2502 \u2502 \u251c\u2500 __snapshots__\n \u2502 \u2502 \u2502 \u2502 \u2514\u2500 header.test.tsx.snap\n \u2502 \u2502 \u2502 \u2514\u2500 header.test.tsx\n \u2502 \u2502 \u251c\u2500 Header.tsx\n \u2502 \u2502 \u251c\u2500 header.less\n \u2502 \u2502 \u2514\u2500 index.ts\n \u2502 \u2502 ...\n \u251c\u2500 ...\n \u251c\u2500 App.tsx\n \u2514\u2500 main.global.css\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Single Page Application",type:"info",children:(0,r.jsxs)(n.p,{children:["In addition to this SSR configuration, there is a typical\nClematis Webpack SPA configuration in ",(0,r.jsx)(n.a,{href:"/clematis.doc/docs/recipe-book/webpack/spa",children:"The Recipe Book"})]})}),"\n",(0,r.jsx)(n.h2,{id:"cosmic",children:"Cosmic"}),"\n",(0,r.jsx)(n.p,{children:"Cosmic has chosen Vite not to speed up the development process, but also to be\na React/Vite sandbox."}),"\n",(0,r.jsx)(n.h3,{id:"vite-configuration",children:"Vite Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Vite requires the following set of dependencies to be included in a project:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "devDependencies": {\n    "@vitejs/plugin-react": "^4.3.4",\n    "vite": "^6.0.11",\n    "vite-plugin-eslint2": "^5.0.3",\n    "vite-tsconfig-paths": "^5.1.4"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"It is easy to start off with this configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:'title="vite.config.ts"',children:"/** @type {import('vite').UserConfig} */\n\nimport { defineConfig } from 'vite';\nimport react from '@vitejs/plugin-react';\nimport tsconfigPaths from 'vite-tsconfig-paths';\n\n// https://vite.dev/config/\nexport default defineConfig({\n  plugins: [react(), tsconfigPaths()],\n  server: {\n    port: 3030,\n  },\n  preview: {\n    port: 3000,\n  },\n});\n\n"})}),"\n",(0,r.jsx)(n.p,{children:"However, it is more convenient to use scaffolding:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm create vite@latest\n"})}),"\n",(0,r.jsx)(n.p,{children:"Vite uses two plugins:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@vitejs/plugin-react",children:"@vitejs/plugin-react"})," contains\nfast refresh for development, uses the automatic JSX runtime, uses custom Babel plugins and\npresets."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/vite-tsconfig-paths",children:"vite-tsconfig-paths"})," the ability to resolve imports using TypeScript's path mapping."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(96540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);