"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[9965],{59826:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"web-applications/code-standards","title":"Code Standards","description":"Prettier","source":"@site/docs/web-applications/code-standards.md","sourceDirName":"web-applications","slug":"/web-applications/code-standards","permalink":"/clematis.doc/docs/web-applications/code-standards","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"prettier","permalink":"/clematis.doc/docs/tags/prettier"},{"inline":true,"label":"eslint","permalink":"/clematis.doc/docs/tags/eslint"},{"inline":true,"label":"lint-staged","permalink":"/clematis.doc/docs/tags/lint-staged"}],"version":"current","lastUpdatedAt":1742201711000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4,"tags":["prettier","eslint","lint-staged"]},"sidebar":"tutorialSidebar","previous":{"title":"Module Bundlers","permalink":"/clematis.doc/docs/web-applications/module-bundlers"},"next":{"title":"Cucumber And Playwright","permalink":"/clematis.doc/docs/web-applications/cucumber-playwright"}}');var s=t(74848),r=t(28453);const o={sidebar_position:4,tags:["prettier","eslint","lint-staged"]},l="Code Standards",a={},c=[{value:"Prettier",id:"prettier",level:2},{value:"Customized Settings",id:"customized-settings",level:3},{value:"ESLint",id:"eslint",level:2},{value:"Plugins For React",id:"plugins-for-react",level:3},{value:"Integration With Vite",id:"integration-with-vite",level:3},{value:"Integration With Angular And Nx",id:"integration-with-angular-and-nx",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"code-standards",children:"Code Standards"})}),"\n",(0,s.jsx)(n.h2,{id:"prettier",children:"Prettier"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://prettier.io/docs/",children:"Prettier"})," is an opinionated code formatter, and it\nis installed the same way and acts the same for all the projects, it requires\nzero configuration if a dev team is happy with the default style."]}),"\n",(0,s.jsxs)(n.p,{children:["The goal of prettier is to make code ",(0,s.jsx)("i",{children:"look"})," the same way across the projects,\nnot to catch errors, which is a task for ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Lint_%28software%29",children:"linters"}),".\nThe Dev team of Prettier decides which code style is optimal,\nand it changes from one version of the tool\nto another. So it is advisable to have a specific version in ",(0,s.jsx)(n.code,{children:"package.json"})," file."]}),"\n",(0,s.jsx)(n.p,{children:"Prettier claims to guarantee that the code will not be broken after the formatting."}),"\n",(0,s.jsx)(n.h3,{id:"customized-settings",children:"Customized Settings"}),"\n",(0,s.jsxs)(n.p,{children:["For Clematis projects, it is a common thing to have it installed with some defaults changed\nand an additional library to turn off conflicting settings with ",(0,s.jsx)(n.a,{href:"https://eslint.org/",children:"ESlint"})," linter:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev --save-exact prettier\nnpm install --save-dev eslint-config-prettier\n"})}),"\n",(0,s.jsx)(n.p,{children:"The customised settings are:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title=".prettierrc" ',children:'{\n  "singleQuote": true,\n  "quoteProps": "consistent"\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"And the ignored files configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prettier",metastring:'title=".prettierignore" ',children:"# Ignore artifacts:\n.angular\n/.nx/cache\n/.nx/workspace-data\n/.vscode/\n\ncoverage\nnode_modules\ndist\n"})}),"\n",(0,s.jsx)(n.p,{children:"The tool can be run with the following command in the root directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"prettier --write .\n"})}),"\n",(0,s.jsx)(n.h2,{id:"eslint",children:"ESLint"}),"\n",(0,s.jsxs)(n.p,{children:["The second actor to analyze the code is one of the most popular\nJavaScript ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Lint_%28software%29",children:"linters"}),":\n",(0,s.jsx)(n.a,{href:"https://eslint.org/",children:"ESList"}),". It is also completely pluggable and is used the same\nway across all the projects:"]}),"\n",(0,s.jsx)(n.p,{children:"It is advisable to have the latest version of the tool, as it may have more cases to\nvalidate than the previous ones:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm init @eslint/config@latest\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Migration",type:"warning",children:(0,s.jsxs)(n.p,{children:["Since it is the newest version installed, a new config system is used. In the new system,\n",(0,s.jsx)(n.code,{children:".eslintrc*"})," is no longer used, ",(0,s.jsx)(n.code,{children:"eslint.config.js"})," should be the default config file name."]})}),"\n",(0,s.jsx)(n.h3,{id:"plugins-for-react",children:"Plugins For React"}),"\n",(0,s.jsx)(n.p,{children:"ESLint uses plugins for configuration, and it requires a few plugins for React, JavaScript,\nTypeScript, Jest, and Prettier, for example, as below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "devDependencies": {\n        "@eslint/js": "^9.19.0",\n        "eslint": "^9.19.0",\n        "eslint-config-prettier": "^10.0.1",\n        "eslint-plugin-prettier": "^5.2.3",\n        "eslint-plugin-react": "^7.37.4",\n        "eslint-plugin-react-hooks": "^5.0.0",\n        "eslint-plugin-jest": "^28.11.0",\n        "eslint-plugin-react-refresh": "^0.4.14",\n        "typescript-eslint": "^8.22.0"\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.mdxAdmonitionTitle,{}),(0,s.jsxs)(n.p,{children:["Plugin ",(0,s.jsx)(n.code,{children:"eslint-config-react-app"})," is not using eslint version 9"]})]}),"\n",(0,s.jsxs)(n.p,{children:["The plugins are added to the new configuration file, and there is a trick with the old\n",(0,s.jsx)(n.code,{children:"eslint-plugin-react-hooks"})," and ",(0,s.jsx)(n.code,{children:"prettier"})," plugins. It requires ",(0,s.jsx)(n.code,{children:"FlatCompat"}),"\nto be used to get flat configuration, for instance ",(0,s.jsx)(n.code,{children:"...compat.extends('plugin:react-hooks/recommended')"}),"\ninstead of, say, ",(0,s.jsx)(n.code,{children:"pluginReactHooks.configs.flat.recommended"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:'title="eslint.config.js"',children:"import { FlatCompat } from '@eslint/eslintrc';\nimport globals from 'globals';\nimport pluginJs from '@eslint/js';\nimport tseslint from 'typescript-eslint';\nimport pluginReact from 'eslint-plugin-react';\n\nconst compat = new FlatCompat();\n\n/** @type {import('eslint').Linter.Config[]} */\nexport default [\n    {\n        files: ['**/*.{js,mjs,cjs,ts,jsx,tsx}'],\n    },\n    {\n        languageOptions: {\n            globals: globals.browser,\n        },\n    },\n    pluginJs.configs.recommended,\n    ...tseslint.configs.recommended,\n    pluginReact.configs.flat.recommended,\n    pluginReact.configs.flat['jsx-runtime'],\n    ...compat.extends('plugin:react-hooks/recommended'),\n    ...compat.extends('plugin:jest/recommended'),\n    {\n        rules: {\n            'react/jsx-uses-react': 'off',\n            'react/react-in-jsx-scope': 'off',\n        },\n    },\n    ...compat.extends('plugin:prettier/recommended'),\n];\n\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.mdxAdmonitionTitle,{}),(0,s.jsx)(n.p,{children:"Prettier plugin should go the last to override all linting settings."})]}),"\n",(0,s.jsxs)(n.p,{children:["The last step is to add a line to ",(0,s.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "lint": "eslint src"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"integration-with-vite",children:"Integration With Vite"}),"\n",(0,s.jsxs)(n.p,{children:["Since Vite is using plugins for configuration, it is required to install a plugin,\nin particular ",(0,s.jsx)(n.code,{children:"vite-plugin-eslint2"}),", not ",(0,s.jsx)(n.code,{children:"vite-plugin-eslint"})," (it is discontinued):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" npm install vite-plugin-eslint2 --save-dev\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then the plugin should go to a Vite configuration file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="vite.config.js"',children:'/** @type {import(\'vite\').UserConfig} */\n\nimport { defineConfig } from "vite";\nimport react from "@vitejs/plugin-react";\nimport tsconfigPaths from "vite-tsconfig-paths";\n/**\n * @ts-expect-error See https://github.com/gxmari007/vite-plugin-eslint/issues/79\n * import eslint from "vite-plugin-eslint";\n */\nimport eslint from "vite-plugin-eslint2";\n\n// https://vite.dev/config/\nexport default defineConfig({\n    plugins: [react(), tsconfigPaths(), eslint()],\n    server: {\n        port: 3030,\n    },\n    preview: {\n        port: 3000,\n    },\n});\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Where ",(0,s.jsx)(n.code,{children:"rules"})," section contains some custom styles."]}),"\n",(0,s.jsx)(n.h3,{id:"integration-with-angular-and-nx",children:"Integration With Angular And Nx"}),"\n",(0,s.jsxs)(n.p,{children:["Angular and ",(0,s.jsx)(n.a,{href:"https://nx.dev",children:"Nx"})," also are using plugins to extend their functionality,\nso it is required to add plugin ",(0,s.jsx)(n.a,{href:"https://nx.dev/nx-api/eslint",children:(0,s.jsx)(n.code,{children:"@nx/eslint"})})," for Nx to support ESLint.\nOther plugins for ESLint itself: ",(0,s.jsx)(n.code,{children:"@typescript-eslint/eslint-plugin"})," for TypeScript,\n",(0,s.jsx)(n.code,{children:"eslint-plugin-html"})," for HTML templates and for Prettier as well ",(0,s.jsx)(n.code,{children:"eslint-config-prettier"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "devDependencies": {\n    "@nx/eslint": "19.5.7",\n    "@nx/eslint-plugin": "19.5.7",\n    "eslint": "^8.57.1",\n    "eslint-config-prettier": "^9.1.0",\n    "eslint-plugin-html": "^8.1.2",\n    "@typescript-eslint/eslint-plugin": "^7.18.0",\n    "@typescript-eslint/parser": "^7.18.0",\n    "@typescript-eslint/utils": "^7.18.0"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{title:"Migration",type:"tip",children:(0,s.jsx)(n.p,{children:"Money Tracker uses ESLint version 8, it is planned to migrate it to version 9, with the changes\nin the configuration files."})}),"\n",(0,s.jsx)(n.p,{children:"The configuration file in the root of the project then looks like below:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title=".eslintrc.json"',children:'{\n  "root": true,\n  "ignorePatterns": ["!**/*"],\n  "plugins": ["@nx", "html"],\n  "overrides": [\n    {\n      "files": ["*.ts", "*.tsx", "*.js", "*.jsx"],\n      "rules": {\n        "@nx/enforce-module-boundaries": [\n          "error",\n          {\n            "enforceBuildableLibDependency": true,\n            "allow": [],\n            "depConstraints": [\n              {\n                "sourceTag": "*",\n                "onlyDependOnLibsWithTags": ["*"]\n              }\n            ]\n          }\n        ]\n      }\n    },\n    {\n      "files": ["*.ts", "*.tsx"],\n      "extends": ["plugin:@nx/typescript"],\n      "rules": {}\n    },\n    {\n      "files": ["*.js", "*.jsx"],\n      "extends": ["plugin:@nx/javascript"],\n      "rules": {}\n    },\n    {\n      "files": ["*.spec.ts", "*.spec.tsx", "*.spec.js", "*.spec.jsx"],\n      "env": {\n        "jest": true\n      },\n      "rules": {}\n    }\n  ]\n}\n\n'})}),"\n",(0,s.jsxs)(n.p,{children:["There is one rule ",(0,s.jsx)(n.code,{children:"@nx/enforce-module-boundaries"})," which is specific for Nx monorepo approach,\nand it should be checked for the code to stay within the module borders."]}),"\n",(0,s.jsx)(n.p,{children:"Library and application ESLint configurations are inherited from the root, for example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="apps/money-tracker-ui/.eslintrc.json"',children:'{\n  "extends": ["../../.eslintrc.json"],\n  "plugins": ["html"]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Nx project configuration file should then contain a ",(0,s.jsx)(n.code,{children:"lint"})," task with files\nmasks to process:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "name": "money-tracker-ui",\n  "prefix": "app",\n  "targets": {\n    "lint": {\n      "executor": "@nx/eslint:lint",\n      "outputs": [\n        "{options.outputFile}"\n      ],\n      "options": {\n        "lintFilePatterns": [\n          "apps/money-tracker-ui/**/*.ts",\n          "apps/money-tracker-ui/**/*.html"\n        ]\n      }\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Linting can be run with (to fix add ",(0,s.jsx)(n.code,{children:"-- --fix"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:" nx lint\n nx run shared-components:lint\n nx run model:lint\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var i=t(96540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);