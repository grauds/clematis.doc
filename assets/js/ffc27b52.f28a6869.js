"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[7210],{31169:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"web-applications-security/decommission","title":"Motivation to Upgrade","description":"Security in the Money Tracker application was implemented using","source":"@site/docs/web-applications-security/decommission.md","sourceDirName":"web-applications-security","slug":"/web-applications-security/decommission","permalink":"/clematis.doc/docs/web-applications-security/decommission","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"proxmox","permalink":"/clematis.doc/docs/tags/proxmox"},{"inline":true,"label":"keycloak","permalink":"/clematis.doc/docs/tags/keycloak"}],"version":"current","lastUpdatedAt":1751048335000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["proxmox","keycloak"]},"sidebar":"tutorialSidebar","previous":{"title":"Web Applications Security","permalink":"/clematis.doc/docs/web-applications-security/"},"next":{"title":"Switch to HTTPS","permalink":"/clematis.doc/docs/web-applications-security/keycloak-https"}}');var i=o(74848),a=o(28453);const s={sidebar_position:1,tags:["proxmox","keycloak"]},r="Motivation to Upgrade",c={},d=[{value:"Cost of Maintenance",id:"cost-of-maintenance",level:2},{value:"Decommissioning Embedded Keycloak Server",id:"decommissioning-embedded-keycloak-server",level:2},{value:"Migration to Keycloak Proxmox CT VM",id:"migration-to-keycloak-proxmox-ct-vm",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"motivation-to-upgrade",children:"Motivation to Upgrade"})}),"\n",(0,i.jsxs)(t.p,{children:["Security in the ",(0,i.jsx)(t.a,{href:"https://github.com/grauds/money.tracker.ui",children:"Money Tracker"})," application was implemented using\nan embedded Keycloak server instance and adapters for Spring Boot 2 and for several major versions of Angular.\nThis architecture has been working for over three years.\nI was about to put it to documentation when new versions came out for both Keycloak and Angular,\nwhich brought up significant changes and made the story more complex."]}),"\n",(0,i.jsx)(t.h2,{id:"cost-of-maintenance",children:"Cost of Maintenance"}),"\n",(0,i.jsxs)(t.p,{children:["The embedded instance of Keycloak (Clematis Auth API) is actually a Gradle-based interpretation\nof ",(0,i.jsx)(t.a,{href:"https://github.com/thomasdarimont/embedded-spring-boot-keycloak-server",children:"Thomas Darimont's project"}),", which is\nstopped at Keycloak version 18.x and probably won't be maintained any longer; Clematis Auth API supports Keycloak version 20.\nThe project required development efforts every time a Keycloak version is updated.\nIt would require even more effort to\n",(0,i.jsx)(t.a,{href:"https://github.com/thomasdarimont/embedded-spring-boot-keycloak-server/issues/87",children:"update the application to Spring Boot 3"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"decommissioning-embedded-keycloak-server",children:"Decommissioning Embedded Keycloak Server"}),"\n",(0,i.jsx)(t.p,{children:"It was decided to discontinue the maintenance of Clematis Auth API beyond May 30, 2025, and to delete the project."}),"\n",(0,i.jsx)(t.h2,{id:"migration-to-keycloak-proxmox-ct-vm",children:"Migration to Keycloak Proxmox CT VM"}),"\n",(0,i.jsxs)(t.p,{children:["Since Clematis applications have been living in Proxmox box for one year already, there is a good chance to\ngive Proxmox an opportunity to bridge the gap and to host Keycloak as a virtual machine instance. There is no\nofficial template, but the Proxmox community\nhas it: ",(0,i.jsx)(t.a,{href:"https://community-scripts.github.io/ProxmoxVE/scripts?id=keycloak",children:"Keycloak Template"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"The first step is to open Proxmox VE Shell and use the following to build a CT template:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'bash -c "$(curl -fsSL https://raw.githubusercontent.com/community-scripts/ProxmoxVE/main/ct/keycloak.sh)"\n'})}),"\n",(0,i.jsxs)(t.p,{children:["The next step is to open Proxmox Web Admin UI to ",(0,i.jsx)(t.a,{href:"https://pve.proxmox.com/wiki/Linux_Container",children:"create a new LXC Container"}),".\nThe new Keycloak template was created in the previous step, and it is just required to specify the hardware resources\ndepending on the particular server configuration."]}),"\n",(0,i.jsxs)(t.p,{children:["After the container is started, the new instance of Keycloak is available at container IP address and port 8080. But\nbefore the login page can be used, it is necessary to configure temporary admin access to the server using the\nsteps ",(0,i.jsx)(t.a,{href:"https://github.com/community-scripts/ProxmoxVE/discussions/193",children:"on this page"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",metastring:'title="SSH login to the container IP address"',children:"systemctl stop keycloak.service\ncd /opt/keycloak/bin\n./kc.sh bootstrap-admin user\nsystemctl start keycloak.service\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Follow the onscreen instructions to create a new admin user when running ",(0,i.jsx)(t.code,{children:"./kc.sh bootstrap-admin user"}),"."]}),"\n",(0,i.jsx)(t.admonition,{type:"tip",children:(0,i.jsx)(t.p,{children:"It is a wise move to migrate the configuration from the existing installation of Keycloak. However, be prepared\nin this case to regenerate all the clients' passwords and secrets."})})]})}function p(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>r});var n=o(96540);const i={},a=n.createContext(i);function s(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);