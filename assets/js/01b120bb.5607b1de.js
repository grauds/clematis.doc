"use strict";(self.webpackChunkclematis_doc=self.webpackChunkclematis_doc||[]).push([[8083],{99762:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"web-applications/testing/money-tracker","title":"Money Tracker Testing","description":"By default, Angular uses Jasmine Testing Framework. This","source":"@site/docs/web-applications/testing/money-tracker.md","sourceDirName":"web-applications/testing","slug":"/web-applications/testing/money-tracker","permalink":"/clematis.doc/docs/web-applications/testing/money-tracker","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"jest","permalink":"/clematis.doc/docs/tags/jest"},{"inline":true,"label":"angular","permalink":"/clematis.doc/docs/tags/angular"},{"inline":true,"label":"nx","permalink":"/clematis.doc/docs/tags/nx"},{"inline":true,"label":"jsdom","permalink":"/clematis.doc/docs/tags/jsdom"},{"inline":true,"label":"coverage","permalink":"/clematis.doc/docs/tags/coverage"},{"inline":true,"label":"cobertura","permalink":"/clematis.doc/docs/tags/cobertura"}],"version":"current","lastUpdatedAt":1742201711000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"tags":["jest","angular","nx","jsdom","coverage","cobertura"]},"sidebar":"tutorialSidebar","previous":{"title":"Frontend Testing","permalink":"/clematis.doc/docs/web-applications/testing/"},"next":{"title":"Pomodoro And Jest","permalink":"/clematis.doc/docs/web-applications/testing/pomodoro"}}');var i=n(74848),r=n(28453);const o={sidebar_position:2,tags:["jest","angular","nx","jsdom","coverage","cobertura"]},a="Money Tracker Testing",l={},c=[{value:"Installation",id:"installation",level:2},{value:"Jest And Nx",id:"jest-and-nx",level:2},{value:"Configuration In Subprojects",id:"configuration-in-subprojects",level:2},{value:"Jest And Typescript",id:"jest-and-typescript",level:2},{value:"Testing Plain Code",id:"testing-plain-code",level:2},{value:"Testing With TestBed",id:"testing-with-testbed",level:2},{value:"Providing Service Test Doubles",id:"providing-service-test-doubles",level:2},{value:"Coverage",id:"coverage",level:2}];function d(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"money-tracker-testing",children:"Money Tracker Testing"})}),"\n",(0,i.jsxs)(t.p,{children:["By default, Angular uses ",(0,i.jsx)(t.a,{href:"https://jasmine.github.io/",children:"Jasmine Testing Framework"}),". This\nis a BDD testing framework with ",(0,i.jsx)(t.a,{href:"https://karma-runner.github.io/latest/index.html",children:"Karma Tests Runner"}),".\nHowever, Money Tracker has replaced this bundle with ",(0,i.jsx)(t.a,{href:"https://jestjs.io/docs/getting-started",children:"Jest"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsxs)(t.p,{children:["Jest needs the following dev dependencies, along with a ",(0,i.jsx)(t.a,{href:"https://nx.dev/nx-api/jest",children:"plugin to Nx"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "devDependencies": {\n    "@nx/jest": "19.5.7",\n    "@types/jest": "^29.5.13",\n    "jest": "^29.7.0",\n    "jest-environment-jsdom": "^29.7.0",\n    "jest-preset-angular": "^14.2.4",\n    "ts-jest": "^29.2.5"\n  }\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"jest-and-nx",children:"Jest And Nx"}),"\n",(0,i.jsx)(t.p,{children:"Jest is configured individually for every application or library within Nx mono repository,\nNx merges all the configurations into one root configuration."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["Nx 18+ provides a utility function called getJestProjectsAsync which retrieves\na list of paths to all the Jest config files from subprojects\n(jump to ",(0,i.jsx)(t.a,{href:"https://nx.dev/nx-api/jest#jest",children:"docs"}),"):"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="jest.config.ts"',children:"import { getJestProjectsAsync } from '@nx/jest';\n\nexport default async () => ({\n  projects: await getJestProjectsAsync(),\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"Also, Nx provides a default base configuration for Jest:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="jest.preset.ts"',children:"const nxPreset = require('@nx/jest/preset').default;\n\nmodule.exports = {\n    ...nxPreset,\n    //...\n};\n"})}),"\n",(0,i.jsxs)(t.p,{children:["... and subproject use this ",(0,i.jsx)(t.a,{href:"https://jestjs.io/docs/configuration#preset-string",children:"preset"}),",\nsee the line with ",(0,i.jsx)(t.code,{children:"preset: '../../jest.preset.js'"})," in the following\nparagraph."]}),"\n",(0,i.jsx)(t.h2,{id:"configuration-in-subprojects",children:"Configuration In Subprojects"}),"\n",(0,i.jsxs)(t.p,{children:["This example is for ",(0,i.jsx)(t.code,{children:"apps/money-tracker-ui"})," application. The same configuration\nis copied to other modules with respect to ",(0,i.jsx)(t.code,{children:"displayName"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/jest.config.ts"',children:"/* eslint-disable */\nexport default {\n  displayName: 'money-tracker-ui',\n  preset: '../../jest.preset.js',\n  setupFilesAfterEnv: ['<rootDir>/src/test-setup.ts'],\n  coverageDirectory: '../../coverage/apps/money-tracker-ui/',\n  transform: {\n    '^.+\\\\.(ts|mjs|js|html)$': ['jest-preset-angular', {\n        tsconfig: '<rootDir>/tsconfig.spec.json',\n        stringifyContentPathRegex: '\\\\.(html|svg)$',\n    }],\n  },\n  transformIgnorePatterns: [\n    'node_modules/(?!.*\\\\.mjs$|lodash-es|uri-templates-es)',\n  ],\n  snapshotSerializers: [\n    'jest-preset-angular/build/serializers/no-ng-attributes',\n    'jest-preset-angular/build/serializers/ng-snapshot',\n    'jest-preset-angular/build/serializers/html-comment',\n  ],\n};\n"})}),"\n",(0,i.jsx)(t.admonition,{title:"More info on Jest config",type:"info",children:(0,i.jsxs)(t.p,{children:["Note, this ",(0,i.jsx)(t.code,{children:"jest.config.ts"})," uses\n",(0,i.jsx)(t.a,{href:"https://thymikee.github.io/jest-preset-angular/",children:"jest-preset-angular"})," for\nAngular components tests. More info on configuration options is in the ",(0,i.jsx)(t.a,{href:"https://thymikee.github.io/jest-preset-angular/docs/getting-started/options#brief-explanation-of-config",children:"docs"}),"."]})}),"\n",(0,i.jsxs)(t.p,{children:["For every test Jest is repeating Angular\ntests initialization with ",(0,i.jsx)(t.a,{href:"https://github.com/tinymce/tinymce-angular/blob/main/tinymce-angular-component/src/test/ts/alien/InitTestEnvironment.ts",children:"TestBed.initTestEnvironment"}),"\nto remove the old dependencies for the new component test:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/src/test-setup.ts"',children:"import 'jest-preset-angular/setup-jest';\n"})}),"\n",(0,i.jsx)(t.h2,{id:"jest-and-typescript",children:"Jest And Typescript"}),"\n",(0,i.jsxs)(t.p,{children:["Next important piece of configuration is the usage of the\n",(0,i.jsx)(t.a,{href:"https://github.com/kulshekhar/ts-jest",children:(0,i.jsx)(t.code,{children:"ts-jest"})})," library."]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"ts-jest"})," is a Jest transformer with source map support that lets use Jest to test projects\nwritten in TypeScript."]})}),"\n",(0,i.jsxs)(t.p,{children:["This configuration will collect files containing tests and required TypeScript declarations and feed them\nback to Jest, ",(0,i.jsx)(t.code,{children:"ts-jest"})," configuration follows ",(0,i.jsx)(t.code,{children:"jest-preset-angular"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="apps/money-tracker-ui/jest.config.ts"',children:"/* eslint-disable */\nexport default {\n  displayName: 'money-tracker-ui',\n  preset: '../../jest.preset.js',\n  setupFilesAfterEnv: ['<rootDir>/src/test-setup.ts'],\n  coverageDirectory: '../../coverage/apps/money-tracker-ui/',\n  transform: {\n    '^.+\\\\.(ts|mjs|js|html)$': ['jest-preset-angular', {\n      tsconfig: '<rootDir>/tsconfig.spec.json',\n      stringifyContentPathRegex: '\\\\.(html|svg)$',\n    }],\n  },\n  transformIgnorePatterns: [\n    'node_modules/(?!.*\\\\.mjs$|lodash-es|uri-templates-es)',\n  ],\n  snapshotSerializers: [\n    'jest-preset-angular/build/serializers/no-ng-attributes',\n    'jest-preset-angular/build/serializers/ng-snapshot',\n    'jest-preset-angular/build/serializers/html-comment',\n  ],\n};\n\n"})}),"\n",(0,i.jsx)(t.h2,{id:"testing-plain-code",children:"Testing Plain Code"}),"\n",(0,i.jsx)(t.p,{children:"The most straightforward testing is with plain TypeScript code, as in utility classes:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="libs/model/src/utils/utils.spec.ts"',children:"describe('Utils', () => {\n  it('should create an instance', () => {\n    expect(new Utils()).toBeTruthy();\n  });\n//...\n})\n"})}),"\n",(0,i.jsx)(t.p,{children:"The data can be imported from the other files, for example:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="libs/model/src/utils/utils.spec.ts"',children:"import { token, url, url2, url3 } from './utils.data';\n\ndescribe('Utils', () => {\n    it('should parse a token', () => {\n        const user = Utils.parseJwt(token);\n        expect(user.email).toEqual('some@qa.com');\n        expect(user.userid).toEqual('some');\n    });\n\n})\n"})}),"\n",(0,i.jsx)(t.h2,{id:"testing-with-testbed",children:"Testing With TestBed"}),"\n",(0,i.jsxs)(t.p,{children:["Angular tests are thoroughly described in ",(0,i.jsx)(t.a,{href:"https://angular.dev/guide/testing",children:"Angular Testing Guide"}),".\nThe principal class is ",(0,i.jsx)(t.a,{href:"https://angular.dev/guide/testing",children:(0,i.jsx)(t.code,{children:"TestBed"})}),"\nwhich has a vast API and does almost all testing tasks."]}),"\n",(0,i.jsx)(t.p,{children:"For example, almost all components have this basic test to try to create the component\nand validate if it is created successfully:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"describe('HeaderComponent', () => {\n    let component: HeaderComponent;\n    let fixture: ComponentFixture<HeaderComponent>;\n\n    beforeEach(async () => {\n        await TestBed.configureTestingModule({\n            declarations: [HeaderComponent],\n            imports: [\n                MatSidenavModule,\n                BrowserAnimationsModule,\n                MatSidenavModule,\n                MatToolbarModule,\n                MatIconModule,\n                MatListModule,\n            ],\n            providers: [KeycloakService],\n        }).compileComponents();\n    });\n\n    beforeEach(() => {\n        fixture = TestBed.createComponent(HeaderComponent);\n        component = fixture.componentInstance;\n        fixture.detectChanges();\n    });\n\n    it('should create', () => {\n        expect(component).toBeTruthy();\n    });\n});\n\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Here, ",(0,i.jsx)(t.code,{children:"TestBed.configureTestingModule"})," function configures module context for the component,\nwith dependencies like library classes and services. Also, it declares the component to test:\n",(0,i.jsx)(t.code,{children:"declarations: [HeaderComponent]"}),"."]}),"\n",(0,i.jsx)(t.admonition,{title:"More info",type:"info",children:(0,i.jsxs)(t.p,{children:["These tests are being generated by Angular CLI components scaffolding, however, usually they require more\ndependencies to be added manually to the ",(0,i.jsx)(t.code,{children:"imports"})," section.\nMore info on how to use ",(0,i.jsx)(t.a,{href:"https://angular.dev/api/core/testing/ComponentFixture",children:"ComponentFixture"}),"."]})}),"\n",(0,i.jsx)(t.h2,{id:"providing-service-test-doubles",children:"Providing Service Test Doubles"}),"\n",(0,i.jsxs)(t.p,{children:["If components talk to the other systems, they do it via services, and in most of the cases\nit is not possible to use real services in these unit tests. By default, Angular offers\n",(0,i.jsx)(t.a,{href:"https://angular.dev/guide/testing/components-scenarios#provide-service-test-doubles",children:"Jasmine test doubles"}),";\nhowever, for Money Tracker, ",(0,i.jsx)(t.a,{href:"https://jestjs.io/docs/mock-functions",children:"Jest Mocking Functions"})," are used."]}),"\n",(0,i.jsxs)(t.p,{children:["For example, in the following example, ",(0,i.jsx)(t.code,{children:"TestSearchService"})," is created for tests:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="libs/shared-components/src/lib/service/search.service.spec.ts"',children:"class TestResource extends Resource {}\n\nclass TestSearchService extends SearchService<TestResource> {\n    \n    // can return examples of some real data here\n    searchPage(options?: PagedGetOption,\n               queryName?: string | null): Observable<PagedResourceCollection<TestResource>> {\n        return of({} as PagedResourceCollection<TestResource>);\n    }\n\n    // can return examples of some real data here\n    getPage(options?: PagedGetOption): Observable<PagedResourceCollection<TestResource>> {\n        return of({} as PagedResourceCollection<TestResource>);\n    }\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"If only a signature of a method is required, Jest mock function can create one:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"keycloakServiceMock = {\n    keycloakEvents$: of(),\n    loadUserProfile: jest.fn().mockResolvedValue({}),\n    login: jest.fn().mockResolvedValue({}),\n}\n"})}),"\n",(0,i.jsx)(t.admonition,{title:"Try Copilot",type:"tip",children:(0,i.jsxs)(t.p,{children:["It makes sense to use Copilot or any other generative AI to make such tests.\nFor example, ",(0,i.jsx)(t.code,{children:"apps/money-tracker-ui/src/app/app.component.spec.ts"}),"\nwas generated by Copilot; it was able to correctly detect authentication scenarios for Keycloak.\nHowever, it is always a good idea to trim the tests manually after generation."]})}),"\n",(0,i.jsx)(t.h2,{id:"coverage",children:"Coverage"}),"\n",(0,i.jsx)(t.p,{children:"Jest is configured for all the subprojects and libraries by Nx preset configuration file mentioned\nabove:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",metastring:'title="jest.preset.ts"',children:"const nxPreset = require('@nx/jest/preset').default;\n\nmodule.exports = {\n    //...\n    coverageReporters: ['clover', 'json', 'text', 'cobertura', 'html'],\n    coveragePathIgnorePatterns: [\n        'index.js',\n        'index.jsx',\n        'index.ts',\n        '/node_modules/',\n    ],\n};\n"})})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(96540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);